<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Pigmax v4.5 | Proxy & Support</title>

<style>
        :root {
            --bg-main: #0a0a0c;
            --bg-side: #141417;
            --bg-card: rgba(255, 255, 255, 0.03);
            --text-main: #ffffff;
            --text-dim: #94949e;
            --border: rgba(255, 255, 255, 0.08);
            --accent: #ff4081; 
            --accent-glow: rgba(255, 64, 129, 0.3);
            --msg-out: #ff408122;
            --msg-in: rgba(31, 31, 35, 0.8);
            --font-main: 'Inter', -apple-system, system-ui, sans-serif;
            --chat-bg: #1a1a1e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--font-main); -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--bg-main); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; width: 100%; position: fixed; }

        /* --- AUTH SCREEN --- */
        #auth-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: var(--bg-main); display: flex; align-items: center; justify-content: center;
        }
        #auth-overlay.hidden { display: none !important; }

        .auth-card {
            background: #16161a; border: 1px solid var(--border); padding: 30px;
            border-radius: 28px; width: 90%; max-width: 380px; text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        /* --- LAYOUT --- */
        .sidebar {
            width: 360px; min-width: 360px; background: var(--bg-side); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; z-index: 1000; height: 100%;
        }

        .main-chat { 
            flex: 1; display: flex; flex-direction: column; background: var(--bg-main); 
            position: relative; height: 100%; overflow: hidden;
        }
        
        .chat-top {
            height: 72px; min-height: 72px; padding: 0 15px; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(15px);
            z-index: 800;
        }

        .msg-container { 
            flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px;
            background-color: var(--chat-bg); background-size: cover; background-position: center;
            padding-bottom: 100px;
        }
        
        .input-bar {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 15px 15px calc(15px + env(safe-area-inset-bottom)); 
            display: flex; gap: 10px; align-items: center; border-top: 1px solid var(--border);
            background: rgba(10, 10, 12, 0.98); z-index: 800;
        }

        .chat-list { flex: 1; overflow-y: auto; padding: 12px; }
        .chat-card {
            padding: 16px; border-radius: 18px; margin-bottom: 8px; cursor: pointer;
            display: flex; align-items: center; gap: 14px; transition: 0.2s; border: 1px solid transparent;
        }
        .chat-card.active { background: var(--accent-glow); border-color: var(--accent); }

        .avatar {
            width: 46px; height: 46px; border-radius: 14px; background: var(--accent);
            display: flex; align-items: center; justify-content: center; font-weight: 800; color: #000; position: relative;
        }

        .bubble {
            max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 0.95rem;
            line-height: 1.4; position: relative; word-wrap: break-word;
        }
        .bubble.mine { align-self: flex-end; background: var(--msg-out); border-bottom-right-radius: 4px; border: 1px solid var(--accent); }
        .bubble.theirs { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 4px; }

        .modern-input {
            flex: 1; background: rgba(255,255,255,0.06); border: 1px solid var(--border);
            padding: 14px 18px; border-radius: 14px; color: white; outline: none; font-size: 16px;
        }

        .btn {
            background: var(--accent); color: #000; border: none; padding: 12px 20px;
            border-radius: 14px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .btn-circle { width: 48px; height: 48px; min-width: 48px; border-radius: 50%; padding: 0; }

        .color-dot { width: 35px; height: 35px; border-radius: 10px; cursor: pointer; border: 2px solid transparent; }
        
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        .modal-card { background: #16161a; border: 1px solid var(--border); padding: 25px; border-radius: 28px; width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; }

        .wp-option { width: 100%; height: 50px; border-radius: 12px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; padding: 0 15px; font-weight: 600; border: 2px solid rgba(255,255,255,0.1); }
        
        .hidden { display: none !important; }

        /* Proxy Switch Style */
        .proxy-box {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 18px; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 1100; }
            .sidebar.chat-open { transform: translateX(-100%); }
            .main-chat { width: 100%; }
        }
</style>
  </head>
  <body>

	<div id="auth-overlay">
	  <div class="auth-card">
        <h1 style="color: var(--accent); margin-bottom: 8px;">Pigmax</h1>
        <p style="font-size: 0.8rem; color: var(--text-dim); margin-bottom: 25px;">–ó–∞—â–∏—â–µ–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</p>

        <div id="auth-reg-box" class="hidden">
		  <input type="text" id="reg-nick" class="modern-input" style="width:100%; margin-bottom:12px;" placeholder="–í–∞—à –Ω–∏–∫">
		  <input type="password" id="reg-pin" class="modern-input" style="width:100%; margin-bottom:20px;" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ü–ò–ù">
		  <button class="btn" style="width:100%" id="btn-create-acc">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>

        <div id="auth-login-box" class="hidden">
		  <h4 id="welcome-text" style="margin-bottom:15px;">–ü—Ä–∏–≤–µ—Ç!</h4>
		  <input type="password" id="login-pin" class="modern-input" style="width:100%; margin-bottom:20px;" placeholder="–í–≤–µ–¥–∏—Ç–µ –ü–ò–ù">
		  <button class="btn" style="width:100%" id="btn-login">–í–æ–π—Ç–∏</button>
		  <p style="margin-top:20px; font-size:0.7rem; color:#444; cursor:pointer;" onclick="hardReset()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</p>
        </div>
	  </div>
	</div>

	<div class="sidebar" id="sidebar">
	  <div style="padding: 20px; display: flex; justify-content: space-between; align-items: center;">
        <span style="font-size: 1.6rem; font-weight: 900;">Pigmax</span>
        <button class="btn btn-circle" style="background:var(--bg-card); color:white;" onclick="openModal('settings-modal')">‚öôÔ∏è</button>
	  </div>
	  <div style="padding: 0 20px 15px; display: flex; gap: 10px;">
        <button class="btn" style="flex: 1" onclick="openModal('p2p-modal')">P2P</button>
        <button class="btn" style="flex: 1; background: #333; color: #fff" onclick="createGroup()">–ì—Ä—É–ø–ø–∞</button>
	  </div>
	  <div class="chat-list" id="chat-list"></div>
	</div>

	<div class="main-chat">
	  <div class="chat-top">
        <div style="display: flex; align-items: center; gap: 12px; overflow: hidden;">
		  <button class="btn" style="padding: 10px; background: transparent; color: white; font-size: 1.3rem;" onclick="backToList()">‚Üê</button>
		  <div style="overflow: hidden;">
			<div id="active-title" style="font-weight: 700; white-space: nowrap; text-overflow: ellipsis;">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
			<div id="active-status" style="font-size: 0.7rem; color: var(--text-dim);">–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ</div>
		  </div>
        </div>
        <div id="status-light" style="width: 10px; height: 10px; border-radius: 50%; background: #222;"></div>
	  </div>

	  <div class="msg-container" id="msg-area">
        <div style="margin: auto; text-align: center; color: var(--text-dim);">
		  <div style="font-size: 3rem; margin-bottom: 10px;">üõ°Ô∏è</div>
		  <p>–í–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã —Å–∫–≤–æ–∑–Ω—ã–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º</p>
        </div>
	  </div>

	  <div class="input-bar">
        <button class="btn btn-circle" style="background: var(--bg-card); color: white;">üìé</button>
        <input type="text" id="msg-input" class="modern-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') sendMsg()">
        <button class="btn btn-circle" onclick="sendMsg()">‚û§</button>
	  </div>
	</div>

	<div class="modal-overlay" id="settings-modal">
	  <div class="modal-card">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        
        <p style="font-size: 0.8rem; margin: 15px 0 10px;">–°–µ—Ç—å –∏ –∑–∞—â–∏—Ç–∞:</p>
        <div class="proxy-box">
            <div>
                <div style="font-size: 0.9rem; font-weight: 600;">–õ–µ–≥–∫–∏–π Proxy</div>
                <div style="font-size: 0.65rem; color: var(--text-dim);">–û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (CloudNode)</div>
            </div>
            <input type="checkbox" id="proxy-toggle" style="width:20px; height:20px; accent-color: var(--accent);" onchange="toggleProxy()">
        </div>

        <p style="font-size: 0.8rem; margin: 10px 0 10px;">–¶–≤–µ—Ç —Ç–µ–º—ã:</p>
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
		  <div class="color-dot" style="background: #ff4081;" onclick="applyColor('#ff4081')"></div>
		  <div class="color-dot" style="background: #2979ff;" onclick="applyColor('#2979ff')"></div>
		  <div class="color-dot" style="background: #00e676;" onclick="applyColor('#00e676')"></div>
		  <div class="color-dot" style="background: #ffc107;" onclick="applyColor('#ffc107')"></div>
		  <div class="color-dot" style="background: #9c27b0;" onclick="applyColor('#9c27b0')"></div>
        </div>

        <p style="font-size: 0.8rem; margin-bottom: 10px;">–§–æ–Ω —á–∞—Ç–∞:</p>
        <div class="wp-option" style="background: #1a1a1e;" onclick="applyWall('none', '#1a1a1e')">–û–±—ã—á–Ω—ã–π</div>
        <div class="wp-option" style="background: url('https://images.unsplash.com/photo-1519681393784-d120267973ba?w=400'); background-size: cover;" onclick="applyWall('url(\'https://images.unsplash.com/photo-1519681393784-d120267973ba?w=800\')', '#1a1a1e')">–ì–æ—Ä—ã</div>
        <div class="wp-option" style="background: url('https://images.unsplash.com/photo-1464802686167-b939a67e06a1?w=400'); background-size: cover;" onclick="applyWall('url(\'https://images.unsplash.com/photo-1464802686167-b939a67e06a1?w=800\')', '#1a1a1e')">–ö–æ—Å–º–æ—Å</div>
        
        <button class="btn" style="width:100%; margin-top:20px; background: #fff; color: #000;" onclick="copySupport()">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Ä–∞ üí≥</button>
        
        <button class="btn" style="width:100%; margin-top:10px;" onclick="closeModal('settings-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
	  </div>
	</div>

	<div class="modal-overlay" id="p2p-modal">
	  <div class="modal-card">
        <h3>P2P –ó–∞—â–∏—Ç–∞</h3>
        <div id="p2p-init">
		  <button class="btn" style="width:100%; margin-top:15px;" onclick="p2pStep('host')">–°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é</button>
		  <button class="btn" style="width:100%; margin-top:12px; background:#222; color:#fff" onclick="p2pStep('join')">–í–≤–µ—Å—Ç–∏ –∫–æ–¥</button>
        </div>
        <div id="p2p-h-box" class="hidden">
		  <p style="font-size: 0.6rem;">–í–∞—à –∑–∞—â–∏—Ç–Ω—ã–π –∫–ª—é—á:</p>
		  <textarea id="h-key" class="modern-input" style="height:100px; font-size:0.5rem; width:100%; word-break: break-all;" readonly></textarea>
		  <textarea id="h-res" class="modern-input" style="height:100px; font-size:0.5rem; width:100%; margin-top:10px;" placeholder="–û—Ç–≤–µ—Ç –¥—Ä—É–≥–∞"></textarea>
		  <button class="btn" style="width:100%; margin-top:10px;" onclick="finishP2P()">–°–≤—è–∑–∞—Ç—å</button>
        </div>
        <div id="p2p-j-box" class="hidden">
		  <textarea id="j-key" class="modern-input" style="height:100px; font-size:0.5rem; width:100%;" placeholder="–ö–ª—é—á –¥—Ä—É–≥–∞"></textarea>
		  <textarea id="j-res" class="modern-input" style="height:100px; font-size:0.5rem; width:100%; margin-top:10px;" readonly></textarea>
		  <button class="btn" style="width:100%; margin-top:10px;" onclick="genP2PRes()">–°–æ–∑–¥–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
        </div>
        <button class="btn" style="width:100%; margin-top:15px; background:transparent; color:#555" onclick="closeModal('p2p-modal')">–û—Ç–º–µ–Ω–∞</button>
	  </div>
	</div>

<script>
// --- GLOBAL STATE ---
let user = null;
let chats = [];
let activeId = null;

// --- CORE APP ---
window.onload = function() {
    const savedUser = localStorage.getItem('pig_user_v45');
    if(savedUser) {
        user = JSON.parse(savedUser);
        document.getElementById('auth-login-box').classList.remove('hidden');
        document.getElementById('welcome-text').innerText = `–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${user.nick}!`;
        // Restore Proxy State
        if(user.proxyActive) {
            document.getElementById('proxy-toggle').checked = true;
            updateStatusLight(true);
        }
    } else {
        document.getElementById('auth-reg-box').classList.remove('hidden');
    }

    chats = JSON.parse(localStorage.getItem('pig_chats_v45') || '[]');
    
    document.getElementById('btn-create-acc').addEventListener('click', doRegister);
    document.getElementById('btn-login').addEventListener('click', doLogin);

    if(user) {
        applyColor(user.color || '#ff4081');
        applyWall(user.wall || 'none', user.wallColor || '#1a1a1e');
    }
    renderList();
};

function doRegister() {
    const nick = document.getElementById('reg-nick').value.trim();
    const pin = document.getElementById('reg-pin').value.trim();
    if(!nick || !pin) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ");
    
    user = { id: Date.now(), nick, pin: btoa(pin), color: '#ff4081', wall: 'none', proxyActive: false };
    localStorage.setItem('pig_user_v45', JSON.stringify(user));
    document.getElementById('auth-overlay').classList.add('hidden');
}

function doLogin() {
    const pin = document.getElementById('login-pin').value;
    if(btoa(pin) === user.pin) {
        document.getElementById('auth-overlay').classList.add('hidden');
    } else alert("–ü–ò–ù –Ω–µ–≤–µ—Ä–Ω—ã–π");
}

function hardReset() {
    if(confirm("–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏?")) {
        localStorage.clear();
        location.reload();
    }
}

// --- PROXY & SUPPORT ---
function toggleProxy() {
    const isActive = document.getElementById('proxy-toggle').checked;
    user.proxyActive = isActive;
    localStorage.setItem('pig_user_v45', JSON.stringify(user));
    updateStatusLight(isActive);
    const statusText = isActive ? "Proxy –ê–∫—Ç–∏–≤–µ–Ω" : "–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ";
    document.getElementById('active-status').innerText = statusText;
}

function updateStatusLight(active) {
    document.getElementById('status-light').style.background = active ? '#00e676' : '#222';
    document.getElementById('status-light').style.boxShadow = active ? '0 0 10px #00e676' : 'none';
}

function copySupport() {
    const cardNumber = "2200 1513 2972";
    navigator.clipboard.writeText(cardNumber).then(() => {
        alert("–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: " + cardNumber + "\n–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É!");
    });
}

// --- DESIGN ---
function applyColor(hex) {
    document.documentElement.style.setProperty('--accent', hex);
    document.documentElement.style.setProperty('--accent-glow', hex + '33');
    document.documentElement.style.setProperty('--msg-out', hex + '25');
    if(user) {
        user.color = hex;
        localStorage.setItem('pig_user_v45', JSON.stringify(user));
    }
}

function applyWall(val, color) {
    const area = document.getElementById('msg-area');
    area.style.backgroundImage = val === 'none' ? 'none' : val;
    area.style.backgroundColor = color;
    if(user) {
        user.wall = val;
        user.wallColor = color;
        localStorage.setItem('pig_user_v45', JSON.stringify(user));
    }
}

// --- CHAT LOGIC ---
function renderList() {
    const list = document.getElementById('chat-list');
    list.innerHTML = '';
    chats.forEach(c => {
        const d = document.createElement('div');
        d.className = `chat-card ${activeId === c.id ? 'active' : ''}`;
        d.onclick = () => openChat(c.id);
        d.innerHTML = `<div class="avatar">${c.name[0]}</div><div style="flex:1"><b>${c.name}</b><p style="font-size:0.6rem; color:#666">–ó–∞—â–∏—â–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª</p></div>`;
        list.appendChild(d);
    });
}

function openChat(id) {
    activeId = id;
    const c = chats.find(x => x.id === id);
    document.getElementById('active-title').innerText = c.name;
    document.getElementById('active-status').innerText = user.proxyActive ? "Proxy –ê–∫—Ç–∏–≤–µ–Ω" : "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";
    document.getElementById('sidebar').classList.add('chat-open');
    renderMsgs();
    renderList();
}

function renderMsgs() {
    const area = document.getElementById('msg-area');
    area.innerHTML = '';
    const c = chats.find(x => x.id === activeId);
    if(!c) return;
    c.msgs.forEach(m => {
        const b = document.createElement('div');
        b.className = `bubble ${m.mine ? 'mine' : 'theirs'}`;
        b.innerText = m.val;
        area.appendChild(b);
    });
    area.scrollTop = area.scrollHeight;
}

function sendMsg() {
    const inp = document.getElementById('msg-input');
    const val = inp.value.trim();
    if(!val || !activeId) return;
    const c = chats.find(x => x.id === activeId);
    c.msgs.push({val, mine: true});
    localStorage.setItem('pig_chats_v45', JSON.stringify(chats));
    renderMsgs();
    inp.value = '';
}

function backToList() {
    activeId = null;
    document.getElementById('sidebar').classList.remove('chat-open');
    document.getElementById('active-title').innerText = "–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç";
    document.getElementById('active-status').innerText = user.proxyActive ? "Proxy –ê–∫—Ç–∏–≤–µ–Ω" : "–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ";
}

function createGroup() {
    const n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:");
    if(!n) return;
    const id = Date.now();
    chats.unshift({id, name: n, msgs: []});
    activeId = id;
    localStorage.setItem('pig_chats_v45', JSON.stringify(chats));
    renderList(); openChat(id);
}

// --- P2P SECURITY ---
function generateBigCode(len) {
    const dict = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/_";
    let res = "SEC_PIG_V45_";
    for(let i=0; i<len; i++) res += dict[Math.floor(Math.random()*dict.length)];
    return btoa(res + Date.now());
}

function p2pStep(type) {
    document.getElementById('p2p-init').classList.add('hidden');
    if(type === 'host') {
        document.getElementById('p2p-h-box').classList.remove('hidden');
        document.getElementById('h-key').value = generateBigCode(600);
    } else {
        document.getElementById('p2p-j-box').classList.remove('hidden');
    }
}

function genP2PRes() {
    if(document.getElementById('j-key').value.length < 50) return alert("–ö–ª—é—á –Ω–µ–≤–µ—Ä–µ–Ω");
    document.getElementById('j-res').value = generateBigCode(650);
}

function finishP2P() {
    if(document.getElementById('h-res').value.length < 50) return alert("–û—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–µ–Ω");
    const id = Date.now();
    chats.unshift({id, name: "P2P –ü—Ä–∏–≤–∞—Ç", msgs: []});
    activeId = id;
    localStorage.setItem('pig_chats_v45', JSON.stringify(chats));
    renderList(); openChat(id); closeModal('p2p-modal');
}

// --- MODALS ---
function openModal(id) { document.getElementById(id).style.display = 'flex'; }
function closeModal(id) { 
    document.getElementById(id).style.display = 'none'; 
    document.getElementById('p2p-init').classList.remove('hidden');
    document.getElementById('p2p-h-box').classList.add('hidden');
    document.getElementById('p2p-j-box').classList.add('hidden');
}
</script>
  </body>
</html>
